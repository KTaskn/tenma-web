
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="TENMA AI 競馬予想">
    <meta name="author" content="ktaskn">
    <link rel="shortcut icon" href="/static/images/favicon.png">
    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>
    <script src="/static/js/jquery-3.3.1.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- Google Tag Manager -->
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-T8RD99X');
    </script>
    <!-- End Google Tag Manager -->

    <title>TENMA</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <style type="text/css">
        body {
            font-family:  arial, helvetica, sans-serif;
            line-height: 1.5
        }
        h1 {
            font-size: 26px;
        }
        p {
            font-size: 16px
        }
        .table-predictor {
            font-size: 12px
        }
        .navbar {
            background-color: #2F5277
        }
        .select_form {
            margin-top: 1em;
        }
    </style>
  </head>
  <body>

    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8RD99X"
        height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->

    <nav class="navbar navbar-dark">
        <a class="navbar-brand" href="./">TENMA</a>
    </nav>

    <div class="container">
            <div class="row">
                    <div class="col-sm form-inline">
                        <div class="form-group" style="width: 30%; margin-bottom:0em;">
                            <form name="select_form" class="select_form" style="width:100%">
                                    <select class="custom-select" id="daylist" name="daylist"  style="width:100%">
                                        <option selected>日付</option>
                                    </select>
                            </form>
                        </div>
        
                        <div class="form-group" style="width: 30%; margin-bottom:0em;">
                                <form name="select_form" class="select_form" style="width:100%">
                                    <select class="custom-select" id="jyolist" name="jyolist" style="width:100%">
                                        <option selected>競馬場</option>
                                    </select>
                                </form>
                        </div>
        
                        <div class="form-group" style="width: 30%; margin-bottom:0em;">
                            <form name="select_form" class="select_form" style="width:100%">
                            <select class="custom-select" id="racelist" name="racelist" style="width:100%">
                                <option selected>レース番号</option>
                            </select>
                            </form>
                        </div>
                        <script>
                            $.ajax({
                                url:'./get_racedays',
                                type:'GET'
                            }).done( (data) => {
                                $.each(data, function(index, val){
                                    var row = val.substr(0, 4) + "年" + val.substr(4, 2) + "月" + val.substr(6, 2) + "日"
                                    var path = location.pathname;
                                    if(val.substr(0, 8) == path.substr(1, 8)){
                                        $('#daylist').append('<option value="' + val +'" selected>' + row + '</option>');
                                    }
                                    else{
                                        $('#daylist').append('<option value="' + val +'">' + row + '</option>');
                                    }
                                });


                                
                                var val = $('[name=daylist]').val();
                                $.ajax({
                                    url:'./get_keibajyo',
                                    type:'GET',
                                    data: {
                                        "yearmonthday": val
                                    }
                                }).done( (data) => {
                                    $('#jyolist').empty();
                                    $('#jyolist').append('<option selected>競馬場</option>');
                                    $.each(data, function(index,val){
                                        var path = location.pathname;
                                        if(index == path.substr(9, 2)){
                                            $('#jyolist').append('<option value="' + index +'" selected>' + val + '</option>');
                                        }
                                        else{
                                            $('#jyolist').append('<option value="' + index +'">' + val + '</option>');
                                        }
                                    });
        
                                    var yearmonthday = $('[name=daylist]').val();
                                    var jyocd = $('[name=jyolist]').val();
                                    $.ajax({
                                        url:'./get_race',
                                        type:'GET',
                                        data: {
                                            "yearmonthday": yearmonthday,
                                            "jyocd": jyocd
                                        }
                                    }).done( (data) => {
                                        console.log(data)
                                        $('#racelist').empty();
                                        $('#racelist').append('<option selected>レース番号</option>');

                                        
                                        var path = location.pathname;

                                        $.each(data, function(index,val){
                                            if(val == path.substr(11, 2)){
                                                $('#racelist').append('<option value="' + val +'" selected>' + val + 'R</option>');
                                            }
                                            else{
                                                $('#racelist').append('<option value="' + val +'">' + val + 'R</option>');
                                            }
                                        });
                                    }).fail( (data) => {
                                        $('#racelist').append('<option value="">データが取得できませんでした</option>');
                                    }).always( (data) => {
        
                                    });
        
                                }).fail( (data) => {
                                        $('#jyolist').append('<option value="">データが取得できませんでした</option>');
                                }).always( (data) => {
        
                                });

                            }).fail( (data) => {
                                console.log(data);
                                $('#daylist').append('<option value="">データが取得できませんでした</option>');
                            }).always( (data) => {
        
                            });
        
                            $('[name=daylist]').change(function() {
                                var val = $('[name=daylist]').val();
                                $.ajax({
                                    url:'./get_keibajyo',
                                    type:'GET',
                                    data: {
                                        "yearmonthday": val
                                    }
                                }).done( (data) => {
                                    $('#jyolist').empty();
                                    $('#jyolist').append('<option selected>競馬場を選択してください</option>');
                                    $.each(data, function(index,val){
                                        $('#jyolist').append('<option value="' + index +'">' + val + '</option>');
                                    });
        
                                    var yearmonthday = $('[name=daylist]').val();
                                    var jyocd = $('[name=jyolist]').val();
                                    $.ajax({
                                        url:'./get_race',
                                        type:'GET',
                                        data: {
                                            "yearmonthday": yearmonthday,
                                            "jyocd": jyocd
                                        }
                                    }).done( (data) => {
                                        console.log(data)
                                        $('#racelist').empty();
                                        $('#racelist').append('<option selected>レース番号を選択してください</option>');
                                        $.each(data, function(index,val){
                                            $('#racelist').append('<option value="' + val +'">' + val + 'R</option>');
                                        });
                                    }).fail( (data) => {
                                        $('#racelist').append('<option value="">データが取得できませんでした</option>');
                                    }).always( (data) => {
        
                                    });
        
                                }).fail( (data) => {
                                        $('#jyolist').append('<option value="">データが取得できませんでした</option>');
                                }).always( (data) => {
        
                                });
                            })
        
        
                            $('[name=jyolist]').change(function() {
                                var yearmonthday = $('[name=daylist]').val();
                                var jyocd = $('[name=jyolist]').val();
                                $.ajax({
                                    url:'./get_race',
                                    type:'GET',
                                    data: {
                                        "yearmonthday": yearmonthday,
                                        "jyocd": jyocd
                                    }
                                }).done( (data) => {
                                    console.log(data)
                                    $('#racelist').empty();
                                    $('#racelist').append('<option selected>レース番号を選択してください</option>');
                                    $.each(data, function(index,val){
                                        $('#racelist').append('<option value="' + val +'">' + val + 'R</option>');
                                    });
                                }).fail( (data) => {
                                        $('#racelist').append('<option value="">データが取得できませんでした</option>');
                                }).always( (data) => {
        
                                });
                            })
        
                            $('[name=racelist]').change(function() {
                                var yearmonthday = $('[name=daylist]').val();
                                var jyocd = $('[name=jyolist]').val();
                                var racenum = $('[name=racelist]').val();
                                location.href = "./" + yearmonthday + jyocd + racenum;
                            })
                        </script>
                    </div>
                </div>     
        <div>
            <h1>{{ racename }}</h1>
        </div>

        <div>
            <a 
            class="twitter-share-button"
            href="https://twitter.com/intent/tweet?text={{ tweet_text }}&via=ai_tenma"
            >Tweet</a>
            <script>
                window.twttr = (function(d, s, id) {
                    var js, fjs = d.getElementsByTagName(s)[0],
                        t = window.twttr || {};
                    if (d.getElementById(id)) return t;
                    js = d.createElement(s);
                    js.id = id;
                    js.src = "https://platform.twitter.com/widgets.js";
                    fjs.parentNode.insertBefore(js, fjs);
                    
                    t._e = [];
                    t.ready = function(f) {
                        t._e.push(f);
                    };
                    
                    return t;
                }(document, "script", "twitter-wjs"));
            </script>
        </div>
        
        <canvas class="histchart" id="chartUma"></canvas>
        <canvas class="histchart" id="chartTitiuma"></canvas>
        <canvas class="histchart" id="chartHahauma"></canvas>
        <canvas class="histchart" id="chartKisyu"></canvas>


        <script>        
        var plot_hist = function(url, canvas){
            $.ajax({
                url: url,
                type:'GET'
            }).done( (data) => {
                var ctx = document.getElementById(canvas).getContext('2d');
                var myChart = new Chart(ctx,  {
                    type: 'horizontalBar',
                    data: {
                        labels: Array.from({length: 18}, (v, k) => k).map(x => x + 1),
                        datasets: [{
                            data: data['hist'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        }
                    }
                    });
                }
            );
        }

        plot_hist('./get_hist', 'chartUma');
        plot_hist('./get_hist', 'chartTitiuma');
        plot_hist('./get_hist', 'chartHahauma');
        plot_hist('./get_hist', 'chartKisyu');
        </script>

        <div class="row">
            <div class="col-sm">
                <p style="font-size:10px">当サービスは、利用者が当サービスの利用を通じて発生した不利益に対して一切の責任を負いません。</p>
            </div>
        </div>
    </div>
  </body>
</html>
